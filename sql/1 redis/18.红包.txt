
悲观锁是一种利用数据库内部机制提供的锁的方法，也就是对更新的数据加锁，这样在并发期间一旦有一个事务持有了数据库记录的锁
其他的线程将不能再对数据进行更新了，这就是悲观锁的实现方式。

写锁？？

-----

乐观锁是一种不会阻塞其他线程并发的机制，它不会使用数据库的锁进行实现，它的设计里面由于不阻塞其他线程，所以并不会引发线程频繁挂起和恢复，
这样便能够提高并发能力，所以也有人把它称为非阻塞锁，那么它的机制是怎么样的呢？





乐观锁重入机制
因为乐观锁造成大量更新失败的问题，使用时间戳执行乐观锁重入，是一种提高成功率的方法，比如考虑在 100 毫秒内允许重入，
把 UserRedPacketServiceImpl 中的方法 grapRedPacketForVersion 修改为以下代码。

当因为版本号原因更新失败后，会重新尝试抢夺红包，但是会实现判断时间戳，如果时间戳在 100 毫秒内，就继续，
否则就不再重新尝试，而判定失败，这样可以避免过多的 SQL 执行，维持系统稳定。乐观锁按时间戳重入，如图 4 所示。

-------------